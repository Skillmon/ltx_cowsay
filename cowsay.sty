\RequirePackage{xparse,l3keys2e}

\ProvidesExplPackage
  {cowsay}  {2017/09/18}
  {v0.1}    {Basic cowsay}

\ExplSyntaxOn
\NewDocumentCommand{\cowsay}{ O{} v }{%
  \keys_set:nn { cowsay } { default_animal,#1 }
  \tl_set:Nn \l_cowsay_strlen_tl { \tl_count_tokens:n {#2} }
  \vbox:n{\noindent
    \texttt{\ __\int_step_inline:nnnn{1}{1}{\l_cowsay_strlen_tl}{_}}\\\null
    \texttt{(\ #2\ )}\\[-1ex]\null
    \texttt{\ --\int_step_inline:nnnn{1}{1}{\l_cowsay_strlen_tl}{-}}\\\null
    \texttt{\l_cowsay_animal_tl}}
}

\NewDocumentCommand{\cowthink}{ O{} v }{%
}

\NewDocumentCommand{\DefaultAnimal}{ m }{
  \keys_define:nn { cowsay } { default_animal .meta:n = {#1} }}

\NewDocumentCommand{\AddAnimal}{ s m +v }{%
  \tl_set:Nn \l_tmpa_tl { \ #3 }
  \regex_replace_all:nnN { \r } { \c{newline}\c{null} } \l_tmpa_tl
  \cs_gset_eq:cN { g_cowsay_animal_#2_tl } \l_tmpa_tl
  \keys_define:nn { cowsay } {
    #2 .code:n = \cs_set_eq:Nc \l_cowsay_animal_tl { g_cowsay_animal_#2_tl }
  }
  \IfBooleanT{#1}{
    \keys_define:nn { cowsay } {
      default_animal .meta:n = {#2} }}
}

\ExplSyntaxOff

\AddAnimal*{cow}
{  \  ^__^
    \ (oo)\_______
      (__)\       )\/\
          ||----w |
          ||     ||}
\AddAnimal{duck}
{  \
    \   __
      >(' )
        )/
       /(
      /  `----/
      \  ~=- /
    ~^~^~^~^~^~^~^}
\AddAnimal{smallduck}
{  \
    \
      >()_
       (__)__ _}
